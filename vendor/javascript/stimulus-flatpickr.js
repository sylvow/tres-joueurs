import e from"flatpickr";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;"value"in n&&(n.writable=true);Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){t&&_defineProperties(e.prototype,t);r&&_defineProperties(e,r);return e}function _defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true}):e[t]=r;return e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),true).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _inherits(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)};return _getPrototypeOf(e)}function _setPrototypeOf(e,t){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t;return e};return _setPrototypeOf(e,t)}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if("function"===typeof Proxy)return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!==typeof t&&"function"!==typeof t?_assertThisInitialized(e):t}function _createSuper(e){return function(){var t,r=_getPrototypeOf(e);if(_isNativeReflectConstruct()){var n=_getPrototypeOf(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function camelize(e){return e.replace(/(?:[_-])([a-z0-9])/g,((e,t)=>t.toUpperCase()))}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function dasherize(e){return e.replace(/([A-Z])/g,((e,t)=>`-${t.toLowerCase()}`))}function readInheritableStaticArrayValues(e,t){const r=getAncestorsForConstructor(e);return Array.from(r.reduce(((e,r)=>{getOwnStaticArrayValues(r,t).forEach((t=>e.add(t)));return e}),new Set))}function readInheritableStaticObjectPairs(e,t){const r=getAncestorsForConstructor(e);return r.reduce(((e,r)=>{e.push(...getOwnStaticObjectPairs(r,t));return e}),[])}function getAncestorsForConstructor(e){const t=[];while(e){t.push(e);e=Object.getPrototypeOf(e)}return t.reverse()}function getOwnStaticArrayValues(e,t){const r=e[t];return Array.isArray(r)?r:[]}function getOwnStaticObjectPairs(e,t){const r=e[t];return r?Object.keys(r).map((e=>[e,r[e]])):[]}(()=>{function extendWithReflect(e){function extended(){return Reflect.construct(e,arguments,new.target)}extended.prototype=Object.create(e.prototype,{constructor:{value:extended}});Reflect.setPrototypeOf(extended,e);return extended}function testReflectExtension(){const a=function(){this.a.call(this)};const e=extendWithReflect(a);e.prototype.a=function(){};return new e}try{testReflectExtension()}catch(e){return e=>class extended extends e{}}})();function ClassPropertiesBlessing(e){const t=readInheritableStaticArrayValues(e,"classes");return t.reduce(((e,t)=>Object.assign(e,propertiesForClassDefinition(t))),{})}function propertiesForClassDefinition(e){return{[`${e}Class`]:{get(){const{classes:t}=this;if(t.has(e))return t.get(e);{const r=t.getAttributeName(e);throw new Error(`Missing attribute "${r}"`)}}},[`${e}Classes`]:{get(){return this.classes.getAll(e)}},[`has${capitalize(e)}Class`]:{get(){return this.classes.has(e)}}}}function TargetPropertiesBlessing(e){const t=readInheritableStaticArrayValues(e,"targets");return t.reduce(((e,t)=>Object.assign(e,propertiesForTargetDefinition(t))),{})}function propertiesForTargetDefinition(e){return{[`${e}Target`]:{get(){const t=this.targets.find(e);if(t)return t;throw new Error(`Missing target element "${e}" for "${this.identifier}" controller`)}},[`${e}Targets`]:{get(){return this.targets.findAll(e)}},[`has${capitalize(e)}Target`]:{get(){return this.targets.has(e)}}}}function ValuePropertiesBlessing(e){const t=readInheritableStaticObjectPairs(e,"values");const r={valueDescriptorMap:{get(){return t.reduce(((e,t)=>{const r=parseValueDefinitionPair(t);const n=this.data.getAttributeNameForKey(r.key);return Object.assign(e,{[n]:r})}),{})}}};return t.reduce(((e,t)=>Object.assign(e,propertiesForValueDefinitionPair(t))),r)}function propertiesForValueDefinitionPair(e){const t=parseValueDefinitionPair(e);const{key:r,name:n,reader:i,writer:s}=t;return{[n]:{get(){const e=this.data.get(r);return null!==e?i(e):t.defaultValue},set(e){void 0===e?this.data.delete(r):this.data.set(r,s(e))}},[`has${capitalize(n)}`]:{get(){return this.data.has(r)||t.hasCustomDefaultValue}}}}function parseValueDefinitionPair([e,t]){return valueDescriptorForTokenAndTypeDefinition(e,t)}function parseValueTypeConstant(e){switch(e){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function parseValueTypeDefault(e){switch(typeof e){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}return Array.isArray(e)?"array":"[object Object]"===Object.prototype.toString.call(e)?"object":void 0}function parseValueTypeObject(e){const t=parseValueTypeConstant(e.type);if(t){const r=parseValueTypeDefault(e.default);if(t!==r)throw new Error(`Type "${t}" must match the type of the default value. Given default value: "${e.default}" as "${r}"`);return t}}function parseValueTypeDefinition(e){const t=parseValueTypeObject(e);const r=parseValueTypeDefault(e);const n=parseValueTypeConstant(e);const i=t||r||n;if(i)return i;throw new Error(`Unknown value type "${e}"`)}function defaultValueForDefinition(e){const r=parseValueTypeConstant(e);if(r)return t[r];const n=e.default;return void 0!==n?n:e}function valueDescriptorForTokenAndTypeDefinition(e,t){const i=`${dasherize(e)}-value`;const s=parseValueTypeDefinition(t);return{type:s,key:i,name:camelize(i),get defaultValue(){return defaultValueForDefinition(t)},get hasCustomDefaultValue(){return void 0!==parseValueTypeDefault(t)},reader:r[s],writer:n[s]||n.default}}const t={get array(){return[]},boolean:false,number:0,get object(){return{}},string:""};const r={array(e){const t=JSON.parse(e);if(!Array.isArray(t))throw new TypeError("Expected array");return t},boolean(e){return!("0"==e||"false"==e)},number(e){return Number(e)},object(e){const t=JSON.parse(e);if(null===t||"object"!=typeof t||Array.isArray(t))throw new TypeError("Expected object");return t},string(e){return e}};const n={default:writeString,array:writeJSON,object:writeJSON};function writeJSON(e){return JSON.stringify(e)}function writeString(e){return`${e}`}class Controller{constructor(e){this.context=e}static get shouldLoad(){return true}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(e,{target:t=this.element,detail:r={},prefix:n=this.identifier,bubbles:i=true,cancelable:s=true}={}){const o=n?`${n}:${e}`:e;const c=new CustomEvent(o,{detail:r,bubbles:i,cancelable:s});t.dispatchEvent(c);return c}}Controller.blessings=[ClassPropertiesBlessing,TargetPropertiesBlessing,ValuePropertiesBlessing];Controller.targets=[];Controller.values={};const kebabCase=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase();const capitalize$1=e=>e.charAt(0).toUpperCase()+e.slice(1);const i=["allowInput","altInput","animate","clickOpens","closeOnSelect","disableMobile","enableSeconds","enableTime","inline","noCalendar","shorthandCurrentMonth","static","time_24hr","weekNumbers","wrap"];const s=["altInputClass","conjunction","mode","nextArrow","position","prevArrow","monthSelectorType"];const o=["defaultHour","defaultMinute","defaultSeconds","hourIncrement","minuteIncrement","showMonths"];const c=["disable","enable","disableDaysOfWeek","enableDaysOfWeek"];const u=["defaultDate"];const l=["maxDate","minDate","maxTime","minTime","now"];const f=["altFormat","ariaDateFormat","dateFormat"];const p={string:s,boolean:i,date:l,array:c,number:o,arrayOrString:u};const h=["change","open","close","monthChange","yearChange","ready","valueUpdate","dayCreate"];const y=["calendarContainer","currentYearElement","days","daysContainer","input","nextMonthNav","monthNav","prevMonthNav","rContainer","selectedDateElem","todayDateElem","weekdayContainer"];const d={"%Y":"Y","%y":"y","%C":"Y","%m":"m","%-m":"n","%_m":"n","%B":"F","%^B":"F","%b":"M","%^b":"M","%h":"M","%^h":"M","%d":"d","%-d":"j","%e":"j","%H":"H","%k":"H","%I":"h","%l":"h","%-l":"h","%P":"K","%p":"K","%M":"i","%S":"S","%A":"l","%a":"D","%w":"w"};const g=new RegExp(Object.keys(d).join("|").replace(new RegExp("\\^","g"),"\\^"),"g");const convertDateFormat=e=>e.replace(g,(e=>d[e]));let b=function(t){_inherits(StimulusFlatpickr,t);var r=_createSuper(StimulusFlatpickr);function StimulusFlatpickr(){_classCallCheck(this,StimulusFlatpickr);return r.apply(this,arguments)}_createClass(StimulusFlatpickr,[{key:"initialize",value:function initialize(){this.config={}}},{key:"connect",value:function connect(){this._initializeEvents();this._initializeOptions();this._initializeDateFormats();this.fp=e(this.flatpickrElement,_objectSpread2({},this.config));this._initializeElements()}},{key:"disconnect",value:function disconnect(){const e=this.inputTarget.value;this.fp.destroy();this.inputTarget.value=e}},{key:"_initializeEvents",value:function _initializeEvents(){h.forEach((e=>{if(this[e]){const t=`on${capitalize$1(e)}`;this.config[t]=this[e].bind(this)}}))}},{key:"_initializeOptions",value:function _initializeOptions(){Object.keys(p).forEach((e=>{const t=p[e];t.forEach((t=>{const r=kebabCase(t);this.data.has(r)&&(this.config[t]=this[`_${e}`](r))}))}));this._handleDaysOfWeek()}},{key:"_handleDaysOfWeek",value:function _handleDaysOfWeek(){if(this.config.disableDaysOfWeek){this.config.disableDaysOfWeek=this._validateDaysOfWeek(this.config.disableDaysOfWeek);this.config.disable=[...this.config.disable||[],this._disable.bind(this)]}if(this.config.enableDaysOfWeek){this.config.enableDaysOfWeek=this._validateDaysOfWeek(this.config.enableDaysOfWeek);this.config.enable=[...this.config.enable||[],this._enable.bind(this)]}}},{key:"_validateDaysOfWeek",value:function _validateDaysOfWeek(e){if(Array.isArray(e))return e.map((e=>parseInt(e)));console.error("days of week must be a valid array");return[]}},{key:"_disable",value:function _disable(e){const t=this.config.disableDaysOfWeek;return t.includes(e.getDay())}},{key:"_enable",value:function _enable(e){const t=this.config.enableDaysOfWeek;return t.includes(e.getDay())}},{key:"_initializeDateFormats",value:function _initializeDateFormats(){f.forEach((e=>{this.data.has(e)&&(this.config[e]=convertDateFormat(this.data.get(e)))}))}},{key:"_initializeElements",value:function _initializeElements(){y.forEach((e=>{this[`${e}Target`]=this.fp[e]}))}},{key:"_string",value:function _string(e){return this.data.get(e)}},{key:"_date",value:function _date(e){return this.data.get(e)}},{key:"_boolean",value:function _boolean(e){return!("0"==this.data.get(e)||"false"==this.data.get(e))}},{key:"_array",value:function _array(e){return JSON.parse(this.data.get(e))}},{key:"_number",value:function _number(e){return parseInt(this.data.get(e))}},{key:"_arrayOrString",value:function _arrayOrString(e){const t=this.data.get(e);try{return JSON.parse(t)}catch(e){return t}}},{key:"flatpickrElement",get:function(){return this.hasInstanceTarget&&this.instanceTarget||this.element}}]);return StimulusFlatpickr}(Controller);_defineProperty(b,"targets",["instance"]);export{b as default};

