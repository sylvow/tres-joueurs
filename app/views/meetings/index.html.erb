
<div class="container">

  <div class="row text-center p-2" data-controller="show-filters location-filter">

    <button class="btn btn-primary btn-sm my-3 p-2 col-6 mx-auto rounded-pill"
            data-action="click->show-filters#display"
            data-show-filters-target="filtersButton">
            Filtrer les résultats +
    </button>

    <div class="filter-form d-none p-2" data-show-filters-target="showFilters">

      <%= form_with url: meetings_path, method: :get, local: true do %>

      <div class="container">
        <div class="row align-items-center justify-content-center">

          <div class="col-md-5 my-2">
            <%= search_field_tag :location, params[:location], class: "form-control d-none", id: "aroundMe",
            placeholder: "Localisation", data: { location_filter_target: "aroundMeField"} %>

            <%= search_field_tag :city, params[:city], class: "form-control", id: "cityInp",
            placeholder: "Recherche ta ville", data: { location_filter_target: "cityInput", action: "keyup->location-filter#displayCities"} %>

            <ul data-location-filter-target="results">
            </ul>

          <div class="form-check form-switch">
            <label class="form-check-label text-muted" for="flexSwitchCheckDefault">Rechercher par géolocalisation</label>
            <input class="form-check-input activateGeo " type="checkbox" id="flexSwitchCheckDefault" data-location-filter-target="toggler" data-action="click->location-filter#revealField">
          </div>

            <div class="d-flex p-2">
              <input class="form-range" data-location-filter-target="radius" type="range" value="10" min="1" max="200" oninput="this.nextElementSibling.value = this.value">
              <output ml-4>10</output>km<br>
            </div>
          </div>

          <%# hidden %>
          <div class="col-md-5 my-2 d-none" type="button">
            <%= text_field_tag :lat, params[:lat], class: "form-control",
            placeholder: "lat", data: { location_filter_target: "fieldLat", location_filter_target: "fieldLat"} %>
          </div>
          <div class="col-md-5 my-2 d-none" type="button">
            <%= text_field_tag :lng, params[:lng], class: "form-control",
            placeholder: "lng", data: { location_filter_target: "fieldLng", location_filter_target: "fieldLng"} %>
          </div>
          <div class="col-md-5 my-2 d-none" type="button">
            <%= text_field_tag :radius, params[:radius], class: "form-control",
            placeholder: "radius", data: { location_filter_target: "fieldRadius"} %>
          </div>
          <%# /hidden %>

          <div class="col-md-5 my-2">
            <%= text_field_tag :search, params[:search], class: "form-control", placeholder: "Jeu, Catégorie, Tags etc." %>
          </div>

          <div class="col-md-1">
            <%= submit_tag "Valider", class: "btn btn-success rounded-pill" %>
          </div>

        </div>
      <% end %>
    </div>
</div>
    <%# <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          <div class="modal-body">
            <h5 class="modal-title align-self-center" id="exampleModalLabel">Rechercher autour de toi ?</h5><br> %>
            <%# <input data-location-filter-target="radius" type="range" class="form-range" value="10" min="1" max="300" oninput="this.nextElementSibling.value = this.value"> %>
            <%# <output>10</output>km<br> %>
            <%# <button type="button" class="btn btn-primary m-4" data-bs-dismiss="modal" data-action="click->location-filter#activateGeo">OK</button> %>
            <%# <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-action="click->location-filter#deleteField">Non</button>
          </div>
        </div>
      </div>
    </div> %>

 <div id="mapid"></div>
    <h2 class="my-4">Liste des meetings</h2>
    <div class="meetings-container">

      <% if @meetings.blank? %>
        <p>Désolé, ta recherche n'a retourné aucun résultat</p>
      <% else %>
       <% @meetings.each do |meeting| %>
        <div class="meeting-card shadow rounded-4 row mb-3" style="overflow: hidden;">
          <% if meeting.user != current_user %>
            <%= link_to(meeting_path(meeting), class: "show-link") do %>

            <div class="row meeting-card-top">
              <% unless meeting.user.profile_picture.attached? %>
                <%= image_tag("profil.png", class: "profile-pic") %>
              <% else %>
                <%= cl_image_tag(meeting.user.profile_picture.key, class: "profile-pic") %>
              <% end %>

              <div class="col-3 p-2 <%= meeting_status_class(meeting.status) %> d-flex flex-column justify-content-center align-items-center">
                <%# code %>
                <p class="fs-1 fw-bold"><%= meeting.date.strftime("%d") %></p>
                <p><%= meeting.date.strftime("%B") %></p>
                <p><%= meeting.date.strftime("%H:%M") %></p>
              </div>

              <div class="col-9 p-2" style="height: 100%;">
                <div>
                  <h3><%= meeting.game.name %></h3>
                  <h6><%= meeting.title %></h6>
                  <div class="d-none">
                  <p>Joueurs : <%= meeting.players_needed_min %>
                    <% if !meeting.players_needed_max.blank? %>
                      à <%= meeting.players_needed_max %></p>
                    <% end %>
                    </div>
                  <p>Niveau : <%= meeting.level %></p>
                  <p><strong><%= meeting.place_address %></strong></p>
                </div>
              </div>
            </div>

          <div class="row meeting-card-bottom bg-warning">
            <div class="text-light d-flex justify-content-center align-items-center">
              <p>Recherche <strong><%= meeting.players_needed_min %> </strong>joueurs.ses</p>
            </div>
          </div>

         <% end %>
         <% end %>
        </div>
      <% end %>
      <% end %>
    </div>
  </div>
  <%= link_to new_meeting_path, class: "fixed-button" do %>
    <i class="fa-solid fa-plus create-icon"></i>
    <% end %>
</div>
